name: Create discussion

on:
  # schedule:
  #   # 毎週水曜 13:00 JST に実行
  #   - cron: "0 4 * * wed"
  workflow_dispatch:

jobs:
  get_next_meeting_date:
    uses: route06/actions/.github/workflows/calc_next_date.yml@add-discussion-comment-workflow
    with:
      interval: weekly
      # target_day: wednesday # NOTE: MTG開催曜日に合わせて変更してください

  create_discussion:
    needs: get_next_meeting_date
    uses: route06/actions/.github/workflows/create_gh_discussion.yml@add-discussion-comment-workflow
    with:
      # NOTE: 作成するDiscussionのタイトルを指定
      title: ${{ needs.get_next_meeting_date.outputs.next_date }} 週 Hoge weekly meeting
      # NOTE: category_slugについては補足参照
      category_slug: ideas
      # NOTE: 作成するDiscussionで使用するテンプレートファイルのパスを指定
      description_template_path: .github/workflows/templates/important_discussion.md

  add_comment:
    needs: create_discussion
    uses: route06/actions/.github/workflows/add_discussion_comment.yml@add-discussion-comment-workflow
    with:
      discussion_id: ${{ needs.create_discussion.outputs.discussion_id }}
      comment_template_path: .github/workflows/templates/discussion_comment1.md

  reply_to_comment:
    needs: add_comment
    uses: route06/actions/.github/workflows/add_discussion_comment.yml@add-discussion-comment-workflow
    with:
      discussion_id: ${{ needs.add_comment.outputs.discussion_id }}
      comment_template_path: .github/workflows/templates/discussion_comment2.md
      reply_to_comment_id: ${{ needs.add_comment.outputs.comment_id }}

  debug:
    needs: reply_to_comment
    runs-on: ubuntu-latest
    steps:
      - name: debug log
        run: |
          echo "discussion_id: ${{ needs.reply_to_comment.outputs.discussion_id }}"
          echo "comment_id: ${{ needs.reply_to_comment.outputs.comment_id }}"

